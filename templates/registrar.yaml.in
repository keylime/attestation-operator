apiVersion: apps/v1
kind: Deployment
metadata:
  name: keylime-registrar
  namespace: REPLACE_KEYLIME_NAMESPACE
  labels:
    app: keylime
spec:
  selector:
    matchLabels:
      app: keylime
      role: registrar
  replicas: 1
  template:
    metadata:
      labels:
        app: keylime
        role: registrar
    spec:
      containers:
      - name: registrar
        image: REPLACE_KEYLIME_IMAGE_PREFIX/keylime_registrar
        imagePullPolicy: IfNotPresent
        envFrom:
          - configMapRef:
               name: REPLACE_KEYLIME_CFGMAP_NAME
        resources:
          limits:
            cpu: "2"
            memory: 3G
          requests:
            cpu: "2"
            memory: 3G
        ports:
        - containerPort: REPLACE_KEYLIME_REGISTRAR_PORT
        - containerPort: REPLACE_KEYLIME_REGISTRAR_TLS_PORT       
        volumeMounts: 
        - name: REPLACE_KEYLIME_SECRETS_NAME-volume
          readOnly: true
          mountPath: "REPLACE_KEYLIME_ACTUAL_CERTS_DIR"
      volumes:
      - name: REPLACE_KEYLIME_SECRETS_NAME-volume
        secret:
          secretName: REPLACE_KEYLIME_SECRETS_NAME
---
apiVersion: v1
kind: Service
metadata:
  name: keylime-registrar-http
  namespace: REPLACE_KEYLIME_NAMESPACE
  labels:  
    app: keylime
    role: registrar
spec:
  type: NodePort
  ports:
  - port: REPLACE_KEYLIME_REGISTRAR_PORT
    targetPort: REPLACE_KEYLIME_REGISTRAR_PORT
    nodePort: REPLACE_KEYLIME_REGISTRAR_PORT_EXTERNAL
  selector:
    app: keylime
    role: registrar
---
apiVersion: v1
kind: Service
metadata:
  name: keylime-registrar-https
  namespace: REPLACE_KEYLIME_NAMESPACE
  labels:  
    app: keylime
    role: registrar
spec:
  type: NodePort
  ports:
  - port: REPLACE_KEYLIME_REGISTRAR_TLS_PORT
    targetPort: REPLACE_KEYLIME_REGISTRAR_TLS_PORT
    nodePort: REPLACE_KEYLIME_REGISTRAR_TLS_PORT_EXTERNAL
  selector:
    app: keylime
    role: registrar